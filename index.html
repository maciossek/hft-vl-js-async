<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>HFT IPR Async JS, AJAX, Fetch API</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/custom.css">
		<link rel="stylesheet" href="css/theme/black.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/atom-one-dark.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
		<script async src="https://production-assets.codepen.io/assets/embed/ei.js"></script>

	</head>
	<!-- https://media.giphy.com/media/OvzMNfWETBoKQ/giphy.gif -->
	<body>
		<div class="reveal">
			<div class="slides">
				<section data-background-size="cover" data-background-image="https://media.giphy.com/media/11wwey5o0EbXTq/giphy.gif">
					<h1 class="title">IPR</h1>
					<h3 class="title">AJAX, Async JS, Fetch API</h3>
				</section>
				<section>
					<section data-background-size="cover" data-background-image="https://media.giphy.com/media/lDT56lCmFnTt6/giphy.gif">
						<h1 class="title"><a style="color: red" href="http://itsalmo.st/#timetohavefinishedallassignments" target="_blank">DONT FAIL</a></h1>
					</section>
				</section>
				<section>
					<section>
						<h2>Async JS</h2>
						Der Umgang mit asynchronem JavaScript kann mit Events, Callbacks und Promises erfolgen
					</section>
					<section>
						<img height="500px" style="background-color: white;" src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d8/Ajax-vergleich.svg/1170px-Ajax-vergleich.svg.png">
						<small>Das Modell einer traditionellen Webanwendung (links) im direkten Vergleich mit einer Ajax-Webanwendung (rechts). Sämtliche Anwendungsdaten werden auf dem Server in einer Datenbank und/oder einem Legacy-System abgespeichert.</small>
					</section>
					<section>
						<img height="500px" style="background-color: white;" src="https://upload.wikimedia.org/wikipedia/commons/8/8f/Prozessfluss-traditionell.svg">
					</section>
					<section>
						<img height="500px" style="background-color: white;" src="https://upload.wikimedia.org/wikipedia/commons/4/4a/Prozessfluss-ajax.svg">
					</section>
					<section>
						<h2>Funktion, die 2 Zahlen addiert</h2>
						<pre><code class="js" data-trim data-noescape>
							// add two numbers normally

							function add (num1, num2) {
							    return num1 + num2;
							}

							const result = add(1, 2); // you get result = 3 immediately
						</code></pre>
					</section>
					<section>
						<h2>Asynchrone Funktion auf dem Server, die 2 Zahlen addiert</h2>
						<pre><code class="js" data-trim data-noescape>
							const result = getAddResultFromServer('http://www.example.com?num1=1&num2=2');
						</code></pre>
						Problem: Wir wissen nicht, wann die Antwort vom Server kommt!
					</section>
				</section>
				<section>
					<section>
						<h2>Callbacks</h2>
						<pre><code class="js" data-trim data-noescape>
							// add two numbers remotely
							// get the result by calling an API

							function addAsync (num1, num2, callback) {
							    // use the famous jQuery getJSON callback API
							    return $.getJSON('http://www.example.com', {
							        num1: num1,
							        num2: num2
							    }, callback);
							}

							addAsync(1, 2, success => {
							    // callback
							    const result = success; // you get result = 3 here
							});
						</code></pre>
					</section>
					<section>
						<h2>Mehrere Aufrufe der synchronen Funktion</h2>
						<pre><code class="js" data-trim data-noescape>
							// add two numbers normally

							let resultA, resultB, resultC;

							function add (num1, num2) {
							    return num1 + num2;
							}

							resultA = add(1, 2); // you get resultA = 3 immediately
							resultB = add(resultA, 3); // you get resultB = 6 immediately
							resultC = add(resultB, 4); // you get resultC = 10 immediately

							console.log('total' + resultC);
							console.log(resultA, resultB, resultC);
						</code></pre>
					</section>
					<section>
						<h2>Mehrere Aufrufe der asynchronen Funktion: Callback Hell</h2>
						<img height="500px" style="background-color: white; border: 0;" src="https://media.giphy.com/media/Lopx9eUi34rbq/giphy.gif">
					</section>
					<section>
						<pre><code class="js" data-trim data-noescape>
							// add two numbers remotely
							// get the result by calling an API

							let resultA, resultB, resultC;

							function addAsync (num1, num2, callback) {
							    // use the famous jQuery getJSON callback API
							    return $.getJSON('http://www.example.com', {
							        num1: num1,
							        num2: num2
							    }, callback);
							}

							addAsync(1, 2, success => {
							    // callback 1
							    resultA = success; // you get result = 3 here

							    addAsync(resultA, 3, success => {
							        // callback 2
							        resultB = success; // you get result = 6 here

							        addAsync(resultB, 4, success => {
							            // callback 3
							            resultC = success; // you get result = 10 here

							            console.log('total' + resultC);
							            console.log(resultA, resultB, resultC);
							        });
							    });
							});
						</code></pre>
					</section>
				</section>
				<section>
					<section>
						<h2>Promises</h2>
            <img height="500px" style="background-color: white; border: 0;" src="https://media.giphy.com/media/l1J9wZJLPywQuKovK/giphy.gif">
					</section>
					<section>
						<h2>Promise Status</h2>
						<ul>
							<li>Pending: Es ist unklar wann man das Telefon erhält</li>
							<li>Resolved: Ihr erhaltet ein neues Telefon</li>
							<li>Rejected: Ihr erhaltet kein neues Telefon</li>
						</ul>
					</section>
					<section>
						<h2>Promise erstellen</h2>
						<pre><code class="js" data-trim data-noescape>
              const promise = new Promise(function(resolve, reject) {
              // do a thing, possibly async, then…

              if (/* everything turned out fine */) {
                resolve("Stuff worked!");
              }
              else {
                reject(Error("It broke"));
              }
            });
						</code></pre>
					</section>
						</code></pre>
					</section>
					<section>
						<h2>Promise verwenden: neue Syntax</h2>
						<pre><code class="js" data-trim data-noescape>
              promise.then(function(result) {
                console.log(result); // "Stuff worked!"
              }, function(err) {
                console.log(err); // Error: "It broke"
              });
						</code></pre>
					</section>
					<section>
						<h2>Promise verwenden: neue Syntax</h2>
						<pre><code class="js" data-trim data-noescape>
              try {
                const result = await promise
                console.log(result)
              } catch (err) {
                console.log(err)
              }
					<section>
						<h2>Promise chaining (verketten)</h2>
						<pre><code class="js" data-trim data-noescape>
              const anotherPromise = async (aValue) => {
                return new Promise((resolve, reject) => {
                  resolve(aValue);
                });
              }

              promise
                .then(anotherPromise)
                .then(result => console.log(result))
						</code></pre>
					</section>
				</section>
				<section>
					<section>
						<h2>AJAX</h2>
						<ul>
							<li>AJAX: Asynchronous JavaScript and XML</li>
							<li>Laden von Daten im Hintergrund und Anzeige auf der Webseite ohne erneutes Laden</li>
						</ul>
					</section>
					<section>
						<h2>VanillaJS</h2>
						<pre><code class="js" data-trim data-noescape>
							var str = "blupp"
							var xhttp = new XMLHttpRequest();
						  xhttp.onreadystatechange = function() {
						    if (this.readyState == 4 && this.status == 200) {
						    	document.getElementById("txtHint").innerHTML = this.responseText;
						    }
						  };
						  xhttp.open("GET", "meineUrl.php?param="+blupp, true);
						  xhttp.send();
						</code></pre>
					</section>
					<section>
						<h2>jQuery</h2>
						<h3>GET - Holt Daten von einer Resource</h3>
						<pre><code class="js" data-trim data-noescape>
							$.get(URL,callback);
						</code></pre>
						<pre><code class="js" data-trim data-noescape>
							$("button").click(function(){
							    $.get("demo_test.php", function(data, status){
							        alert("Data: " + data + "\nStatus: " + status);
							    });
							});
						</code></pre>
					</section>
					<section>
						<h2>jQuery</h2>
						<h3>POST - Schickt Daten die bearbeitet werden sollen an eine Resource</h3>
						<pre><code class="js" data-trim data-noescape>
							$.post(URL,data,callback);
						</code></pre>
						<pre><code class="js" data-trim data-noescape>
							$("button").click(function(){
							    $.post("demo_test_post.php",
							    {
							        name: "Donald Duck",
							        city: "Duckburg"
							    },
							    function(data, status){
							        alert("Data: " + data + "\nStatus: " + status);
							    });
							});
						</code></pre>
					</section>
				</section>
				<section>
					<section>
						<h2>Fetch API</h2>
						<ul>
							<li>Neue API, die in aktuellen Browsern implementiert ist</li>
							<li>Return Wert ist immer ein Promise</li>
							<li>Fehlerfälle sind angenehm mit try catch abzufangen</li>
							<li>Keine externe Bibliothek notwendig</li>
						</ul>
					</section>
					<section>
						<h2>Fetch API Beispiel</h2>
						<pre><code class="js" data-trim data-noescape>
              try {
                const response = await fetch('https://davidwalsh.name/some/url', {
                  method: 'get'
                })
              } catch(e) {
                console.error(e)
              }
						</code></pre>
					</section>
					<section>
						<h2>Request Class</h2>
						<pre><code class="js" data-trim data-noescape>
							var request = new Request('https://davidwalsh.name/users.json', {
								method: 'POST',
								mode: 'cors',
								redirect: 'follow',
								headers
							});

							// Now use it!
							const response = await fetch(request)
						</code></pre>
					</section>
					<section>
						<h2>Headers Class</h2>
						<pre><code class="js" data-trim data-noescape>
							// Create an empty Headers instance
							var headers = new Headers();

							// Add a few headers
							headers.append('Content-Type', 'text/plain');
							headers.append('X-My-Custom-Header', 'CustomValue');

							// Check, get, and set header values
							headers.has('Content-Type'); // true
							headers.get('Content-Type'); // "text/plain"
							headers.set('Content-Type', 'application/json');

							// Delete a header
							headers.delete('X-My-Custom-Header');

							// Add initial values
							var headers = new Headers({
								'Content-Type': 'text/plain',
								'X-My-Custom-Header': 'CustomValue'
							});
						</code></pre>
					</section>
					<section>
						<h2>Mit JSON Umgehen</h2>
						<pre><code class="js" data-trim data-noescape>
							const response = await fetch('https://davidwalsh.name/demo/arsenal.json')
              const json = await response.json()
              console.log(json);
						</code></pre>
					</section>
					<section>
						<h2>Mit Text Umgehen</h2>
						<pre><code class="js" data-trim data-noescape>
              const response = await fetch('/next/page')
              const text = await response.text()
              console.log(text);
						</code></pre>
					</section>
					<section>
						<h2>Mit Blobs Umgehen</h2>
						<pre><code class="js" data-trim data-noescape>
              const response = await fetch('https://images.unsplash.com/photo-1524303676975-5989d34c6854?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=313a3c6819248cf686124e9caa8a9846&auto=format&fit=crop&w=450&q=80')
              const imageBlob = await response.blob()
              document.querySelector('img').src = URL.createObjectURL(imageBlob);
						</code></pre>
					</section>
					<section>
						<h2>Mit Formulardaten umgehen</h2>
						<pre><code class="js" data-trim data-noescape>
							fetch('https://davidwalsh.name/submit', {
								method: 'post',
								body: new FormData(document.getElementById('comment-form'))
							});

							// oder

							fetch('https://davidwalsh.name/submit-json', {
								method: 'post',
								body: JSON.stringify({
									email: document.getElementById('email').value,
									answer: document.getElementById('answer').value
								})
							});
						</code></pre>
					</section>
				</section>
				<section>
					<section>
						<h2>Übung</h2>
							<ul>
								<li>Legen Sie auf dem Server ein neues Verzeichnis an: <code class="hljs">~/public_html/JQYAJX/</code></li>
								<li>Ihr Gästebuch soll nun asynchron funktionieren</li>
								<li>Ein neuer Eintrag im Gästebuch darf nicht dazu führen, dass die Seite neugeladen wird!</li>
								<li>Schreiben sie ein PHP Script, dass die JavaScript Anfrage versteht und XML oder JSON zurückliefert</li>
								<li>Verwenden sie AJAX oder die Fetch API um eine Anfrage an ihr PHP Script zu stellen.</li>
								<li>Reagieren sie auf den SUCCESS und auf den ERROR Fall, damit ihre Software einwandfrei funktioniert!</li>
							</ul>
					</section>
					<section>
						<h2>Weitere Links</h2>
						<ul>
							<li><a href="https://scotch.io/tutorials/javascript-promises-for-dummies" target="_blank">Promises for dummies</a></li>
						</ul>
					</section>
				</section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			Reveal.initialize({
				backgroundTransition: 'slide',
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
transition
